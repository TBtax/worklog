<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DailyTrack‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡πâ‡∏≠‡∏ô‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô Prompt
                        sans: ['Prompt', 'Inter', 'sans-serif'], 
                    },
                    colors: {
                        // Custom color scheme: Changed to Rich Indigo
                        // **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç** ‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏∂‡πâ‡∏ô
                        'primary-accent': '#3a0172',       // Main Accent (Rich Indigo)
                        'primary-hover': '#290150',        // Darker shade for button hover
                        'soft-focus': '#5e179d',           // Focus Ring (Vibrant Indigo for Border)
                        
                        // ‡∏™‡∏µ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°
                        'page-bg': '#f4f0fa',              // Page Background (Very Light Purple)
                        'soft-divider': '#eae4f3',         // Soft Divider (Light Purple-Gray)
                        'accent-sunset': '#f72585',        // Secondary Accent (Vibrant Magenta - Warning)
                        
                        // Text Colors (Kept for consistency with previous requests)
                        'active-text-main': '#1f2937',     // Dark Gray (Gray-800)
                        'active-text-table': '#000000',    // Black
                        'placeholder-text': '#9ca3af',     // Light Gray (Gray-400)
                    }
                }
            }
        }
    </script>
    <style>
        /* --- NEW: Background Gradient Styling (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Gradient) --- */
        body {
            /* **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç** ‡πÄ‡∏õ‡πá‡∏ô Gradient ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%) */
            background-image: linear-gradient(to top, #a18cd1 0%, #fbc2eb 100%); 
            background-size: cover; /* ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
            background-attachment: fixed; /* ‡∏ï‡∏£‡∏∂‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏ß‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Scroll */
            background-repeat: no-repeat; /* ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ã‡πâ‡∏≥‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û */
            background-position: center center; /* ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á */
            background-color: #f4f0fa; /* ‡∏™‡∏µ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ */
        }
        
        /* Custom styles for input focus */
        .input-group input:focus, 
        .input-group select:focus, 
        .input-group textarea:focus {
            border-color: #3a0172; /* primary-accent ‡πÉ‡∏´‡∏°‡πà */
            /* ‡πÉ‡∏ä‡πâ custom RGBA shadow derived from #3a0172 */
            box-shadow: 0 0 0 2px rgba(58, 1, 114, 0.3); 
            outline: none;
        }
        
        /* General input/select style refinement */
        .input-group input, .input-group select {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); 
            transition: all 0.2s;
        }

        /* --- MAIN FORM PLACEHOLDER/DEFAULT STYLING (Date, Selects, Textarea) --- */
        
        /* Date input color handling */
        .input-group input[type="date"], .input-group input[type="text"] {
            color: #1f2937; /* ‡∏ï‡∏±‡πâ‡∏á‡∏™‡∏µ Active Text ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
        }
        .input-group input[type="text"]::placeholder {
             color: #9ca3af; /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Placeholder */
        }
        

        /* Select fields (Agent/Requester) */
        .input-group select:valid {
            color: #1f2937; /* Active color (Dark Gray) */
        }
        
        /* Textarea (Notes) placeholder */
        .input-group textarea::placeholder {
            color: #9ca3af;
        }


        /* --- TABLE STYLING: Clean, Modern, Responsive --- */
        .log-table {
            border-collapse: separate;
            border-spacing: 0 0; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); 
            border-radius: 12px; 
            overflow: hidden; 
            width: 100%; 
            table-layout: fixed; 
        }
        
        /* Header Styling */
        .log-table th {
            /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô Light Purple-Gray */
            background-color: #e9e5f1; 
            color: #3a0172; /* primary-accent ‡πÉ‡∏´‡∏°‡πà */
            font-weight: 550;
            text-transform: uppercase;
            font-size: 0.75rem;
            border: none;
            border-right: 1px solid #eae4f3; /* soft-divider */
            padding: 10px 6px; 
        }
        
        /* Body Styling - Clean separation */
        .log-table td {
             background-color: #ffffff; 
             border: none; 
             border-bottom: 1px solid #eae4f3; /* soft-divider */
             padding: 8px 6px; 
             vertical-align: middle;
             font-size: 11px; /* Font size 11px */
             color: #000000; /* Table Active Text Color: Black */
        }
        
        /* Input/Select inside table */
        .log-table input[type="text"], .log-table input[type="number"], 
        .log-table select { 
            border: 1px solid #e5e7eb; 
            height: 30px; 
            border-radius: 4px;
            font-size: 11px; 
            transition: border-color 0.2s;
            padding: 4px 6px; 
            width: 100%; /* Full width */
            color: #000000; /* ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å */
        }
        
        /* --- ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Placeholder ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á --- */
        .log-table input[type="text"]::placeholder, .log-table input[type="number"]::placeholder {
             color: #9ca3af; /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Placeholder */
        }
        
        .log-table input[type="text"]:focus, .log-table input[type="number"]:focus, .log-table select:focus {
            border-color: #3a0172; /* primary-accent ‡πÉ‡∏´‡∏°‡πà */
            box-shadow: none; 
        }

        /* Other table styling remain */
        .log-table th:last-child {
            border-right: none;
        }
        .log-table thead tr:first-child th:first-child { border-radius: 12px 0 0 0; }
        .log-table thead tr:first-child th:last-child { border-radius: 0 12px 0 0; }
        .log-table thead { position: sticky; top: 0; z-index: 10; }
        .log-table tbody tr:last-child td { border-bottom: none; }
        .log-table tbody tr:hover td { background-color: #f6f4fa; } 
        
        /* --- NEW MODAL STYLING FOR BLUR BACKDROP --- */
        .modal-backdrop {
            background-color: rgba(255, 255, 255, 0.1); /* Light transparent white */
            backdrop-filter: blur(5px); /* Apply the blur effect */
            -webkit-backdrop-filter: blur(5px); /* For Safari support */
        }
        
        /* --- EXPORT TABLE STYLING: Hide from view but keep structured for export --- */
        #export-data-container {
            position: absolute;
            left: -9999px;
            top: -9999px;
        }

        /* --- NEW: Custom Style for Grouped Dropdown Header --- */
        .group-header-option {
            /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö Theme */
            background-color: #e9e5f1 !important; /* soft-divider color */
            color: #3a0172 !important; /* primary-accent ‡πÉ‡∏´‡∏°‡πà */
            /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏≤ */
            font-weight: 700 !important; 
            padding: 6px 4px !important;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/table2excel@1.0.4/dist/table2excel.min.js"></script>
</head>

<body class="font-sans min-h-screen px-4 pb-4 pt-2 sm:px-8 sm:pb-8 sm:pt-4">

    <div class="max-w-7xl mx-auto bg-white shadow-2xl rounded-2xl p-6 md:p-12 border border-gray-100 transition-all duration-300">

        <header class="mb-6 border-b-4 border-primary-accent/50 pb-3">
            <div class="flex flex-col sm:flex-row sm:items-end justify-between gap-4">
                <h1 class="text-2xl font-extrabold text-gray-800 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" class="inline-block w-6 h-6 mr-1" viewBox="0 0 24 24">
                        <path fill="#e9e5f1" d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8l-6-6z" />
                        <path fill="#3a0172" d="M14 2v6h6" />
                        <path fill="#f72585" d="M16 13H8v-2h8v2zm-8 4h8v-2H8v2z" />
                    </svg>
                    DailyTrack ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô
                </h1>

                <div class="flex space-x-6 items-center">
                    
                    <div class="input-group flex items-center space-x-2">
                        <label for="date" class="text-sm font-semibold text-gray-700 whitespace-nowrap">
                            üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å <span class="text-accent-sunset">*</span>
                        </label>
                        <input type="text" id="date" required 
                               class="p-2 text-sm w-36"
                               placeholder="‡∏ß‡∏ß/‡∏î‡∏î/‡∏õ‡∏õ‡∏õ‡∏õ"> 
                    </div>

                    <div class="input-group flex items-center space-x-2">
                        <label for="requester" class="text-sm font-semibold text-gray-700 whitespace-nowrap">
                            üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô <span class="text-accent-sunset">*</span>
                        </label>
                        <select id="requester" required
                                class="p-2 text-sm bg-white w-52">
                            <option value="" disabled selected>-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô --</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>
        <form id="logForm">
            <div class="space-y-8">
                
                <div class="pt-0">
                    <div class="flex justify-between items-center mb-4">
                         <h3 class="text-lg font-bold text-gray-800 flex items-center">
                            ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô
                            <span class="text-accent-sunset text-base ml-2">*</span>
                         </h3>
                         <p class="text-right text-s font-medium text-red-500 flex items-center flex-shrink-0 ml-4">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-accent-sunset" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.542 2.705-1.542 3.47 0l5.58 11.25A1.5 1.5 0 0116.035 17H3.964a1.5 1.5 0 01-1.359-2.651l5.58-11.25zM10 10a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1zm0-4a1 1 0 00-1 1v1a1 1 0 102 0V7a1 1 0 00-1-1z" clip-rule="evenodd" />
                             </svg>
                             ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ ‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏†‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤
                         </p>
                    </div>
                    <div> 
                        <table class="w-full log-table">
                            <colgroup>
                                <col style="width: 2%;">     <col style="width: 15%;">    <col style="width: 15%;">    <col style="width: 14%;">    <col style="width: 19%;">    <col style="width: 13%;">    <col style="width: 9%;">     <col style="width: 9%;">     <col style="width: 10%;">     <col style="width: 13%;">    <col style="width: 7%;"> </colgroup>
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô</th>
                                    <th>Agent</th> 
                                    <th>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô</th>
                                    <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</th>
                                    <th>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</th>
                                    <th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤(‡∏ä‡∏°.)</th> 
                                    <th>‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤(‡∏ô‡∏≤‡∏ó‡∏µ)</th> 
                                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th>‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</th>
                                    <th>   </th> </tr>
                            </thead>
                            <tbody id="log-table-body">
                                </tbody>
                        </table>
                    </div>
                    </div>
                
                <div id="addRowContainer" class="mt-4 flex justify-center">
                    <button type="button" id="addRowBtn" 
                            class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-full text-primary-accent bg-white hover:bg-page-bg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-soft-focus transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                        </svg>
                        ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
                    </button>
                </div>
                <div class="pt-8 border-t border-gray-200">
                    <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                        ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î‡∏á‡∏≤‡∏ô / ‡∏≠‡∏ö‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ / ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
                    </h3>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-4 input-group">
                            <input type="checkbox" id="leave_checkbox" class="h-4 w-4 text-primary-accent border-gray-300 rounded focus:ring-primary-accent">
                            <label for="leave_checkbox" class="text-sm font-medium text-gray-700 w-24 flex-shrink-0">
                                ‡∏•‡∏≤
                            </label>
                            <input type="text" id="leave_details" placeholder="‡∏•‡∏≤xxx ‡∏£‡∏∞‡∏ö‡∏∏ ‡∏ß/‡∏î/‡∏õ" class="p-2 text-sm flex-grow">
                        </div>
                        
                        <div class="flex items-center space-x-4 input-group">
                            <input type="checkbox" id="training_checkbox" class="h-4 w-4 text-primary-accent border-gray-300 rounded focus:ring-primary-accent">
                            <label for="training_checkbox" class="text-sm font-medium text-gray-700 w-24 flex-shrink-0">
                                ‡∏≠‡∏ö‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ
                            </label>
                            <input type="text" id="training_details" placeholder="‡∏≠‡∏ö‡∏£‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£xxx ‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà ‡∏£‡∏∞‡∏ö‡∏∏ ‡∏ß/‡∏î/‡∏õ " class="p-2 text-sm flex-grow">
                        </div>

                        <div class="flex items-center space-x-4 input-group">
                            <input type="checkbox" id="fieldwork_checkbox" class="h-4 w-4 text-primary-accent border-gray-300 rounded focus:ring-primary-accent">
                            <label for="fieldwork_checkbox" class="text-sm font-medium text-gray-700 w-24 flex-shrink-0">
                                ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
                            </label>
                            <input type="text" id="fieldwork_details" placeholder="‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡πÄ‡∏¢‡πà‡∏ô‡∏ï‡πå ‡∏ö‡∏à‡∏Å.xxxx ‡∏£‡∏∞‡∏ö‡∏∏ ‡∏ß/‡∏î/‡∏õ" class="p-2 text-sm flex-grow">
                        </div>

                        <div class="flex items-center space-x-4 input-group">
                            <label for="substitute_worker" class="text-xs font-medium text-gray-700 w-32 flex-shrink-0 whitespace-nowrap">
                                ‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡πÅ‡∏ó‡∏ô (‡∏ö‡∏±‡∏î‡∏î‡∏µ‡πâ)
                            </label>
                            <select id="substitute_worker" class="p-2 text-sm bg-white flex-grow">
                                <option value="" selected>-- ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô --</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="border-t pt-8 border-gray-200">
                    <div class="input-group">
                        <label for="notes" class="block text-lg font-bold text-gray-800 mb-2">
                            üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) 
                        </label>
                        <textarea id="notes" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°(‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" 
                                  class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-primary-accent focus:border-primary-accent"></textarea>
                    </div>
                </div>

                <div class="pt-6 text-right flex flex-col items-end">
                    <div id="totalDurationDisplay" class="text-xl font-bold text-gray-800 mb-4 pr-1">
                        </div>
                    
                    <button type="submit" 
                            class="inline-flex items-center px-8 py-3 border border-transparent text-base font-bold rounded-full shadow-lg text-white bg-primary-accent hover:bg-primary-hover focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-soft-focus transition duration-150 ease-in-out">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                          <path d="M7.707 10.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V6h5a2 2 0 012 2v7a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h5v5.586l-1.293-1.293z" />
                        </svg>
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </div>
        </form>
        
        <div id="messageBox" class="fixed bottom-4 right-4 p-4 rounded-xl shadow-2xl text-white hidden transition-opacity duration-300 z-50" style="min-width: 300px;">
            <p id="messageText" class="font-medium"></p>
        </div>
        
    </div>
    
    <div id="export-data-container">
        <table id="combined-export-table">
            <tbody>
                </tbody>
        </table>
    </div>

    <div id="exportModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="absolute inset-0 modal-backdrop opacity-0 transition-opacity duration-300" id="exportModalBackdrop"></div>
        
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden max-w-lg w-full transform scale-90 opacity-0 transition-all duration-300 relative z-10" id="exportModalContent">
            
            <div class="bg-primary-accent/5 p-4 border-b border-soft-divider flex items-center">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary-accent mr-3" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z" clip-rule="evenodd" />
                </svg>
                <h4 class="text-lg font-bold text-gray-800">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</h4>
            </div>

            <div class="p-6">
                <p class="text-gray-700 text-center text-xl font-medium mb-6">
                    ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
                </p>
                
                <div class="flex justify-center space-x-6">
                    
                    <button id="exportExcelBtn" 
                            class="inline-flex items-center px-6 py-3 border border-transparent text-base font-bold rounded-full shadow-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-green-400 transition duration-150 ease-in-out">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        Export
                    </button>
                    
                    <button id="closeModalBtn" 
                            class="inline-flex items-center px-6 py-3 border border-transparent text-base font-bold rounded-full shadow-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-red-400 transition duration-150 ease-in-out">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                        ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
                    </button>
                </div>
            </div>
            
        </div>
    </div>
    <div id="finalStatusModal" class="fixed inset-0 z-[101] hidden flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="absolute inset-0 modal-backdrop opacity-0 transition-opacity duration-300" id="finalStatusModalBackdrop"></div>
        
        <div class="bg-white rounded-xl shadow-2xl overflow-hidden max-w-lg w-full transform scale-90 opacity-0 transition-all duration-300 relative z-10" id="finalStatusModalContent">
            
            <div class="bg-primary-accent/5 p-4 border-b border-soft-divider flex items-center">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600 mr-3" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <h4 class="text-lg font-bold text-gray-800">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå</h4>
            </div>

            <div class="p-6 text-center">
                <p id="finalMessageText" class="text-gray-700 text-xl font-medium mb-6"></p>
                
                <button id="closeFinalModalBtn" 
                        class="inline-flex items-center px-6 py-3 border border-transparent text-base font-bold rounded-full shadow-md text-white bg-primary-accent hover:bg-primary-hover focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-soft-focus transition duration-150 ease-in-out">
                    ‡∏ï‡∏Å‡∏•‡∏á
                </button>
            </div>
            
        </div>
    </div>
    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Export)
        let lastSubmissionData = null; 
        
        // --- 1. Helper function for UI feedback (Now only for error/validation messages) ---
        function showMessage(text, type = 'error') {
            if (type !== 'error') {
                 return; 
            }
            
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            
            messageText.textContent = text;
            messageBox.className = "fixed bottom-4 right-4 p-4 rounded-xl shadow-2xl transition-opacity duration-300 z-50 bg-red-600 text-white";
            
            messageBox.classList.remove('hidden');
            messageBox.style.opacity = '1';

            setTimeout(() => {
                messageBox.style.opacity = '0';
                setTimeout(() => messageBox.classList.add('hidden'), 300);
            }, 5000); 
        }

        // --- 2. Make.com Webhook Configuration and Constants ---
        const MAKE_WEBHOOK_URL = 'https://hook.eu2.make.com/oiuaxedvnczvdte6vdwq9zudmfhiijvo'; 
        
        // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" ‡πÉ‡∏ô Header)
        const EMPLOYEE_LIST_JSON_URL = './employees.json'; 
        
        // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Agent (‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Agent ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
        const AGENT_LIST_JSON_URL = './agents.json'; 
        
        // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
        const CUSTOMER_LIST_JSON_URL = './requesters.json'; 

        // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô (‡πÉ‡∏´‡∏°‡πà: ‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á) 
        const TOPIC_LIST_JSON_URL = './topics.json'; 
        
        // --- START: MODIFICATION 1 - New URLs for Time and Status ---
        const TIME_OPTIONS_JSON_URL = './time_options.json'; 
        const STATUS_OPTIONS_JSON_URL = './status.json'; 
        // --- END: MODIFICATION 1 ---
        
        let EMPLOYEE_OPTIONS = []; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Header: ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
        let AGENT_OPTIONS = [];    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á: Agent
        let CUSTOMER_OPTIONS = []; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á: ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô
        let TOPIC_OPTIONS = [];    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á: ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô
        
        // --- START: MODIFICATION 1 - New Variables for Loaded Data ---
        let TIME_OPTIONS = { hours: [], minutes: [] };    
        let STATUS_OPTIONS_LOADED = [];    
        // --- END: MODIFICATION 1 ---


        // --- 3. Function to load and populate all configuration lists (Renamed) ---
        async function loadConfigurationData() {
            // A. Load Employee List (for ID: requester -> "‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" ‡πÉ‡∏ô Header)
            try {
                const response = await fetch(EMPLOYEE_LIST_JSON_URL);
                if (!response.ok) throw new Error(`HTTP status: ${response.status}. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå employees.json`);
                EMPLOYEE_OPTIONS = await response.json();
                
                const employeeSelect = document.getElementById('requester');
                employeeSelect.innerHTML = '<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô --</option>';
                EMPLOYEE_OPTIONS.forEach(name => {
                    employeeSelect.innerHTML += `<option value="${name}">${name}</option>`;
                });
                
                // Populate Substitute Worker dropdown
                const substituteSelect = document.getElementById('substitute_worker');
                if (substituteSelect) {
                    // Use a value="" option that is not disabled, as this field is optional
                    substituteSelect.innerHTML = '<option value="" selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡πÅ‡∏ó‡∏ô --</option>'; 
                    EMPLOYEE_OPTIONS.forEach(name => {
                        substituteSelect.innerHTML += `<option value="${name}">${name}</option>`;
                    });
                }
                
            } catch (error) {
                console.error("Error loading employee list:", error);
                document.getElementById('requester').innerHTML = '<option value="" disabled>-- ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß --</option>';
                // Handle error case for substitute worker
                const substituteSelect = document.getElementById('substitute_worker');
                if (substituteSelect) {
                    substituteSelect.innerHTML = '<option value="" disabled>-- ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß --</option>';
                }
            }

            // B. Load Agent List (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Agent ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
            try {
                const response = await fetch(AGENT_LIST_JSON_URL);
                if (!response.ok) throw new Error(`HTTP status: ${response.status}. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå agents.json`);
                AGENT_OPTIONS = await response.json();
            } catch (error) {
                console.error("Error loading agent list:", error);
            }

            // C. Load Customer/Requester List (‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á: ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô)
            try {
                const response = await fetch(CUSTOMER_LIST_JSON_URL);
                if (!response.ok) throw new Error(`HTTP status: ${response.status}. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå requesters.json`);
                CUSTOMER_OPTIONS = await response.json();
                
            } catch (error) {
                console.error("Error loading customer list:", error);
            }

            // D. Load Topic List (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á) 
            try {
                const response = await fetch(TOPIC_LIST_JSON_URL);
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö
                if (!response.ok) {
                   console.error(`HTTP status: ${response.status}. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå topics.json`);
                   TOPIC_OPTIONS = []; // ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Array ‡∏ß‡πà‡∏≤‡∏á
                } else {
                   // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON
                   TOPIC_OPTIONS = await response.json();
                }
            } catch (error) {
                // ‡∏´‡∏≤‡∏Å‡∏°‡∏µ Syntax Error ‡πÉ‡∏ô JSON ‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
                console.error("Error loading topic list (Check JSON syntax):", error);
                TOPIC_OPTIONS = []; // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ error ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ Array ‡∏ß‡πà‡∏≤‡∏á
            }
            
            // --- START: MODIFICATION 1 - Load Time and Status Options ---
            // E. Load Time Options (for Hours and Minutes)
            try {
                const response = await fetch(TIME_OPTIONS_JSON_URL);
                if (!response.ok) throw new Error(`HTTP status: ${response.status}. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå time_options.json`);
                TIME_OPTIONS = await response.json();
            } catch (error) {
                console.error("Error loading time options:", error);
            }

            // F. Load Status Options
            try {
                const response = await fetch(STATUS_OPTIONS_JSON_URL);
                if (!response.ok) throw new Error(`HTTP status: ${response.status}. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå status.json`);
                STATUS_OPTIONS_LOADED = await response.json();
            } catch (error) {
                console.error("Error loading status options:", error);
            }
            // --- END: MODIFICATION 1 ---


            // After loading, initialize the table for the first time
            document.getElementById('log-table-body').innerHTML = ''; // Clear existing rows
            totalRows = 0; // Reset row counter
            addTableRows(ROWS_TO_ADD_BATCH); // Add the initial 10 rows
        }

        // --- 4. Function to dynamically add table rows ---
        let totalRows = 0; // Global counter for total rows in the table
        const ROWS_TO_ADD_BATCH = 10; // Number of rows to add at once
        
        function addTableRows(numRowsToAdd = ROWS_TO_ADD_BATCH) {
            const tableBody = document.getElementById('log-table-body');
            
            const startIndex = totalRows; // Start index is the current total number of rows
            const endIndex = startIndex + numRowsToAdd;

            // Create Requester Dropdown HTML fragment for the table (uses CUSTOMER_OPTIONS)
            let requesterOptionsHtml = '<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
            CUSTOMER_OPTIONS.forEach(req => {
                requesterOptionsHtml += `<option value="${req}">${req}</option>`;
            });
            
            // Create Agent Dropdown HTML fragment for the table (uses AGENT_OPTIONS)
            let agentOptionsHtml = '<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>';
            AGENT_OPTIONS.forEach(name => {
                agentOptionsHtml += `<option value="${name}">${name}</option>`;
            });

            // Create Topic Dropdown HTML fragment for the table (uses TOPIC_OPTIONS)
            let topicOptionsHtml = '<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ --</option>';
            // ‡πÉ‡∏ä‡πâ TOPIC_OPTIONS ‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î‡∏°‡∏≤
            TOPIC_OPTIONS.forEach(item => {
                const disabledAttr = item.isHeader ? 'disabled' : '';
                // ‡πÉ‡∏ä‡πâ class "group-header-option" ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
                const classAttr = item.isHeader ? 'class="group-header-option"' : ''; 
                topicOptionsHtml += `<option value="${item.value}" ${disabledAttr} ${classAttr}>${item.text}</option>`;
            });

            // --- START: MODIFICATION 1 - Use loaded data for Duration and Status ---
            // Create Status Dropdown HTML fragment for the table (Uses STATUS_OPTIONS_LOADED)
            let statusOptionsHtml = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>';
            STATUS_OPTIONS_LOADED.forEach(opt => {
                statusOptionsHtml += `<option value="${opt.value}">${opt.text}</option>`;
            });
            
            // Create Duration (Hours) Dropdown HTML fragment for the table (Uses TIME_OPTIONS.hours)
            let durationOptionsHtml = '<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å--</option>';
            TIME_OPTIONS.hours.forEach(opt => {
                 durationOptionsHtml += `<option value="${opt.value}">${opt.text}</option>`;
            });
            
            // Create Minute Dropdown HTML fragment for the table (Uses TIME_OPTIONS.minutes)
            let minuteOptionsHtml = '<option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å--</option>'; 
            TIME_OPTIONS.minutes.forEach(opt => {
                // Ensure value="0" remains selected by default if that is the intent
                const selectedAttr = opt.value === 0 ? 'selected' : ''; 
                minuteOptionsHtml += `<option value="${opt.value}" ${selectedAttr}>${opt.text}</option>`;
            });
            // --- END: MODIFICATION 1 ---


            for (let i = startIndex; i < endIndex; i++) {
                const row = document.createElement('tr');
                row.id = `log-row-${i}`;
                
                // Column 1: Row Number (#)
                row.innerHTML += `<td>${i + 1}</td>`;

                // Column 2: ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô (Dropdown - uses CUSTOMER_OPTIONS)
                row.innerHTML += `
                    <td>
                        <select id="requester-select-table-${i}" name="requester-select-table" value="" class="bg-white">
                            ${requesterOptionsHtml}
                        </select>
                    </td>
                `;
                
                // Column 3: Agent (Dropdown - uses AGENT_OPTIONS)
                row.innerHTML += `
                    <td>
                        <select id="agent-select-table-${i}" name="agent-select-table" value="" class="bg-white">
                            ${agentOptionsHtml}
                        </select>
                    </td>
                `;

                // Column 4: ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô (MODIFIED: Dropdown - uses TOPIC_OPTIONS)
                row.innerHTML += `
                    <td>
                        <select id="topic-select-table-${i}" name="topic-select-table" value="" class="bg-white">
                            ${topicOptionsHtml}
                        </select>
                    </td>
                `;

                // Column 5: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô (Input Text ONLY)
                row.innerHTML += `
                    <td>
                        <input type="text" id="detail-text-${i}" name="detail-text" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." class="bg-white">
                    </td>
                `;
                
                // Column 6: ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö (Input Text) 
                row.innerHTML += `
                    <td>
                        <input type="text" id="problem-text-${i}" name="problem-text" placeholder="‡∏õ‡∏±‡∏ç‡∏´‡∏≤/‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï" class="bg-white">
                    </td>
                `;

                // Column 7: ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤(‡∏ä‡∏°.) (DROPDOWN) 
                row.innerHTML += `
                    <td>
                        <select id="duration-select-${i}" name="duration-select" value="" class="bg-white">
                             ${durationOptionsHtml}
                        </select>
                    </td>
                `;
                
                // Column 8: ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤(‡∏ô‡∏≤‡∏ó‡∏µ) (DROPDOWN) 
                row.innerHTML += `
                    <td>
                        <select id="minute-select-${i}" name="minute-select" value="" class="bg-white">
                             ${minuteOptionsHtml}
                        </select>
                    </td>
                `;

                // Column 9: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Dropdown) 
                row.innerHTML += `
                    <td>
                        <select id="status-select-${i}" name="status-select" value="" class="bg-white">
                            ${statusOptionsHtml}
                        </select>
                    </td>
                `;

                // Column 10: ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (Input Text) - WIDER
                row.innerHTML += `
                    <td>
                        <input type="text" id="note-text-${i}" name="note-text" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" class="bg-white">
                    </td>
                `;
                
                // START: MODIFICATION 3 - New Delete Button Column
                 row.innerHTML += `
                    <td>
                        <button type="button" 
                                onclick="deleteRow(${i})"
                                class="text-xs font-semibold text-red-600 hover:text-red-800 transition duration-150 p-1 rounded hover:bg-red-50 w-full" 
                                style="white-space: nowrap;">
                            ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </td>
                `;
                // END: MODIFICATION 3
                
                tableBody.appendChild(row);
            }
            
            const prevTotalRows = totalRows;
            totalRows = endIndex; // Update global counter
            updateSelectColorOnLoad();
            
            // NOTE: The event listeners are now attached via delegation in window.addEventListener('load')

            // NEW: Initial update of total duration
            updateTotalDurationDisplay(); 
        }
        
        // START: MODIFICATION 3 - Delete Row Functions (Robust)
        
        // --- NEW: Function to delete a table row ---
        function deleteRow(rowIndex) {
            const row = document.getElementById(`log-row-${rowIndex}`);
            if (row) {
                row.remove();
                
                // Re-index all subsequent rows in the UI and their IDs
                reindexRows(rowIndex);
                
                updateTotalDurationDisplay();
            }
        }
        
        // --- NEW: Function to re-index rows after deletion ---
        function reindexRows(startIndex) {
            const tableBody = document.getElementById('log-table-body');
            const rows = tableBody.getElementsByTagName('tr'); // Live collection of existing rows
            
            // Loop through all *existing* rows from the deleted row's index onwards
            for (let i = startIndex; i < rows.length; i++) {
                const oldRow = rows[i]; 
                const newIndex = i;
                const newRowId = `log-row-${newIndex}`;
                
                // 1. Update Row ID
                oldRow.id = newRowId; 
                
                // 2. Update Row Number Display (First <td>)
                oldRow.querySelector('td:first-child').textContent = newIndex + 1;

                // 3. Update all input/select IDs 
                const elements = oldRow.querySelectorAll('[id^="requester-select-table-"], [id^="agent-select-table-"], [id^="topic-select-table-"], [id^="detail-text-"], [id^="problem-text-"], [id^="duration-select-"], [id^="minute-select-"], [id^="status-select-"], [id^="note-text-"]');
                
                elements.forEach(el => {
                    const idParts = el.id.split('-');
                    idParts[idParts.length - 1] = newIndex; 
                    el.id = idParts.join('-');
                });
                
                // 4. Update Delete Button onclick attribute
                const deleteButton = oldRow.querySelector('button[onclick^="deleteRow("]');
                if (deleteButton) {
                    deleteButton.setAttribute('onclick', `deleteRow(${newIndex})`);
                }
            }
            
            // 5. Update global row counter
            totalRows = rows.length; 
        }
        // END: MODIFICATION 3

        // --- 5. Function to update dropdown text color on load (IMPROVED with Focus/Blur) ---
        function updateSelectColorOnLoad() {
             // select elements ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô header ‡πÅ‡∏•‡∏∞‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
             const selectElements = document.querySelectorAll('select');
             
             // ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
             const ACTIVE_TEXT_COLOR = '#000000'; // ‡∏™‡∏µ‡∏î‡∏≥‡∏™‡∏ô‡∏¥‡∏ó
             const PLACEHOLDER_TEXT_COLOR = '#9ca3af'; // ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô
             
             selectElements.forEach(select => {
                 // 1. Initial check (On Load)
                 const isPlaceholder = select.value === '' || 
                                       (select.options.length > 0 && select.options[select.selectedIndex] && select.options[select.selectedIndex].disabled);
                 
                 if (isPlaceholder) {
                    select.style.color = PLACEHOLDER_TEXT_COLOR; 
                 } else {
                    select.style.color = ACTIVE_TEXT_COLOR; 
                 }
                 
                 // 2. On Change (Permanent change after selection)
                 select.addEventListener('change', function() {
                    const isPlaceholderAfterChange = this.value === '' || 
                                                     (this.options.length > 0 && this.options[this.selectedIndex] && this.options[this.selectedIndex].disabled);
                    
                    if (isPlaceholderAfterChange) {
                        this.style.color = PLACEHOLDER_TEXT_COLOR;
                    } else {
                        this.style.color = ACTIVE_TEXT_COLOR; // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏î‡∏≥‡πÄ‡∏Ç‡πâ‡∏°
                    }
                 });
                 
                 // 3. On Focus (Temporarily change to dark color when actively selecting)
                 select.addEventListener('focus', function() {
                    // Force black text when the select box is actively being used/focused
                    this.style.color = ACTIVE_TEXT_COLOR; 
                 });

                 // 4. On Blur (Revert to placeholder color if value is still empty)
                 select.addEventListener('blur', function() {
                    // Re-check and set to placeholder color if value is still empty when focus is lost
                    const isPlaceholderOnBlur = this.value === '' || 
                                                 (this.options.length > 0 && this.options[this.selectedIndex] && this.options[this.selectedIndex].disabled);
                                    
                    if (isPlaceholderOnBlur) {
                        this.style.color = PLACEHOLDER_TEXT_COLOR;
                    } 
                    // If not placeholder, it stays ACTIVE_TEXT_COLOR (black)
                 });
             });
        }

        // --- 6. Function to collect data from the table (‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå) ---
        function collectTableData() {
            const data = [];
            
            // Loop up to the current total number of rows (including empty/deleted indexes)
            // The logic inside must check for element existence
            for (let i = 0; i < totalRows; i++) {
                
                // Use a check for the row existence after deletion/re-indexing
                const rowElement = document.getElementById(`log-row-${i}`);
                if (!rowElement) {
                    continue; // Skip if the row was deleted
                }

                // Use the rowElement to query children
                const requesterSelectTable = rowElement.querySelector(`[id^="requester-select-table-"]`) ? rowElement.querySelector(`[id^="requester-select-table-"]`).value : '';
                const agentSelectTable = rowElement.querySelector(`[id^="agent-select-table-"]`) ? rowElement.querySelector(`[id^="agent-select-table-"]`).value : ''; 
                const topicSelect = rowElement.querySelector(`[id^="topic-select-table-"]`) ? rowElement.querySelector(`[id^="topic-select-table-"]`).value : ''; 
                const detailText = rowElement.querySelector(`[id^="detail-text-"]`) ? rowElement.querySelector(`[id^="detail-text-"]`).value.trim() : '';
                const problemText = rowElement.querySelector(`[id^="problem-text-"]`) ? rowElement.querySelector(`[id^="problem-text-"]`).value.trim() : ''; 
                const durationSelect = rowElement.querySelector(`[id^="duration-select-"]`) ? rowElement.querySelector(`[id^="duration-select-"]`).value : ''; 
                const minuteSelect = rowElement.querySelector(`[id^="minute-select-"]`) ? rowElement.querySelector(`[id^="minute-select-"]`).value : ''; // NEW FIELD
                const statusSelect = rowElement.querySelector(`[id^="status-select-"]`) ? rowElement.querySelector(`[id^="status-select-"]`).value : ''; 
                const noteTable = rowElement.querySelector(`[id^="note-text-"]`) ? rowElement.querySelector(`[id^="note-text-"]`).value.trim() : ''; 
                
                // Check if any field is filled (Include minuteSelect in check)
                const isRowFilled = requesterSelectTable || agentSelectTable || topicSelect || detailText || durationSelect || (minuteSelect !== '0') || statusSelect || problemText || noteTable;
                
                if (isRowFilled) {
                    data.push({
                        // Get displayed row number
                        row: parseInt(rowElement.querySelector('td:first-child').textContent, 10), 
                        requesterTable: requesterSelectTable, 
                        agentTable: agentSelectTable, 
                        topicDescription: topicSelect, 
                        detailDescription: detailText,
                        problemFound: problemText, 
                        duration: durationSelect, 
                        minuteDuration: minuteSelect, // NEW FIELD
                        status: statusSelect, 
                        noteTable: noteTable 
                    });
                }
            }

            return data;
        }

        // --- NEW: Function to calculate and display total duration ---
        function updateTotalDurationDisplay() {
            let totalDurationInHours = 0;
            
            // Loop through all existing rows
            for (let i = 0; i < totalRows; i++) {
                const durationSelect = document.getElementById(`duration-select-${i}`);
                const minuteSelect = document.getElementById(`minute-select-${i}`); // NEW FIELD
                
                // 1. Add Hours
                if (durationSelect && durationSelect.value) {
                    const hours = parseFloat(durationSelect.value);
                    if (!isNaN(hours)) {
                        totalDurationInHours += hours;
                    }
                }
                
                // 2. Add Minutes (Convert to Hours)
                if (minuteSelect && minuteSelect.value) {
                    const minutes = parseInt(minuteSelect.value, 10);
                    if (!isNaN(minutes)) {
                        totalDurationInHours += (minutes / 60.0);
                    }
                }
            }
            
            const displayElement = document.getElementById('totalDurationDisplay');
            if (displayElement) {
                // START MODIFICATION: Convert decimal hours to Hours and Minutes
                // ‡πÅ‡∏õ‡∏•‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ï‡πá‡∏°
                const totalMinutes = Math.round(totalDurationInHours * 60);
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠
                const hours = Math.floor(totalMinutes / 60);
                const minutes = totalMinutes % 60;
                
                // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                let timeDisplay = '';
                
                if (hours > 0) {
                    timeDisplay += `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`;
                }
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0
                if (minutes > 0) {
                    if (hours > 0) {
                        timeDisplay += ' '; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏ó‡∏µ
                    }
                    timeDisplay += `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
                }

                // ‡∏Å‡∏£‡∏ì‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏•‡∏¢ (‡∏£‡∏ß‡∏° 0 ‡∏ô‡∏≤‡∏ó‡∏µ)
                if (totalMinutes === 0) {
                    timeDisplay = '0 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á 0 ‡∏ô‡∏≤‡∏ó‡∏µ'; 
                }

                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
                displayElement.innerHTML = `‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô: <span class="text-primary-accent">${timeDisplay}</span>`;
                // END MODIFICATION
            }
        }

        
        // --- 7A. MODAL 1 Control Functions ---
        const modal = document.getElementById('exportModal');
        const modalBackdrop = document.getElementById('exportModalBackdrop');
        const modalContent = document.getElementById('exportModalContent');

        function showExportModal() {
            modal.classList.remove('hidden');
            void modal.offsetWidth; 
            
            modalBackdrop.classList.add('opacity-100');
            modalContent.classList.remove('scale-90', 'opacity-0');
            modalContent.classList.add('scale-100', 'opacity-100');
        }

        function hideExportModal() {
            modalBackdrop.classList.remove('opacity-100');
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-90', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300); 
        }
        
        // --- 7B. MODAL 2 Control Functions ---
        const finalModal = document.getElementById('finalStatusModal');
        const finalModalBackdrop = document.getElementById('finalStatusModalBackdrop');
        const finalModalContent = document.getElementById('finalStatusModalContent');
        const finalMessageText = document.getElementById('finalMessageText');
        const closeFinalModalBtn = document.getElementById('closeFinalModalBtn');

        function showFinalStatusModal(message) {
            finalMessageText.textContent = message;
            finalModal.classList.remove('hidden');
            void finalModal.offsetWidth; 
            
            finalModalBackdrop.classList.add('opacity-100');
            finalModalContent.classList.remove('scale-90', 'opacity-0');
            finalModalContent.classList.add('scale-100', 'opacity-100');
        }

        function hideFinalStatusModal() {
            finalModalBackdrop.classList.remove('opacity-100');
            finalModalContent.classList.remove('scale-100', 'opacity-100');
            finalModalContent.classList.add('scale-90', 'opacity-0');
            
            setTimeout(() => {
                finalModal.classList.add('hidden');
            }, 300);
        }

        // Add event listener to close Modal 2
        closeFinalModalBtn.addEventListener('click', hideFinalStatusModal);

        // --- Date Format Function ---
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ö Date Object ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô string "DD/MM/YYYY" 
        function formatDate(date) {
            const d = new Date(date);
            let month = '' + (d.getMonth() + 1);
            let day = '' + d.getDate();
            const year = d.getFullYear();

            // ‡πÄ‡∏ï‡∏¥‡∏° 0 ‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            if (month.length < 2) 
                month = '0' + month;
            if (day.length < 2) 
                day = '0' + day;

            return [day, month, year].join('/'); // DD/MM/YYYY
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ö string "DD/MM/YYYY" ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Date object (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì)
        function parseDate(dateString) {
            const parts = dateString.split('/');
            // new Date(year, monthIndex, day)
            // MonthIndex ‡∏Ñ‡∏∑‡∏≠ 0-11
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        
        // --- NEW: Function to convert DD/MM/YYYY (Gregorian) to DD Mon. YYYY (Buddhist) ---
        function formatDateThaiBuddhist(dateString) {
            const parts = dateString.split('/'); // parts[0]=DD, parts[1]=MM, parts[2]=YYYY
            if (parts.length !== 3) return dateString; // Return original if format is wrong

            const day = parts[0];
            const gregorianYear = parseInt(parts[2], 10);
            const buddhistYear = gregorianYear + 543;
            const monthIndex = parseInt(parts[1], 10) - 1; // 0-11

            // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏¢‡πà‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            const thaiMonths = [
                "‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.",
                "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."
            ];

            const thaiMonth = thaiMonths[monthIndex];

            // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: DD Mon. YYYY (Buddhist) ‡πÄ‡∏ä‡πà‡∏ô 04 ‡∏û.‡∏¢. 2568
            return `${day} ${thaiMonth} ${buddhistYear}`; 
        }
        // --- End Date Format Function ---

        
        // --- 8. Handles the form submission (Modified for date handling and new fields) ---
        document.getElementById('logForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // 1. Collect Table Data 
            const tableData = collectTableData();
            
            // 2. Collect Leave/Training/Fieldwork status
            const leave_checkbox = document.getElementById('leave_checkbox').checked;
            const training_checkbox = document.getElementById('training_checkbox').checked;
            const fieldwork_checkbox = document.getElementById('fieldwork_checkbox').checked;

            // 3. **NEW Validation**: Check if there's log entries OR any checkbox is checked
            const isAnyLeaveChecked = leave_checkbox || training_checkbox || fieldwork_checkbox;
            const hasLogEntries = tableData.length > 0;
            
            if (!hasLogEntries && !isAnyLeaveChecked) {
                 showMessage("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÅ‡∏ñ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏î‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏´‡∏¢‡∏∏‡∏î‡∏á‡∏≤‡∏ô / ‡∏≠‡∏ö‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ / ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà'", "error"); 
                 return;
            }

            // 4. Prepare the final data object
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß) ‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á required ‡∏≠‡∏¢‡∏π‡πà (date, requester)
            if (!document.getElementById('logForm').checkValidity()) {
                 return;
            }
            
            const employeeName = document.getElementById('requester').value; 
            
            const dateInput = document.getElementById('date').value; 
            
            // CRITICAL: Convert DD/MM/YYYY string from input to YYYY-MM-DD for Webhook
            const parts = dateInput.split('/'); 
            let isoDate = dateInput; // Default
            if (parts.length === 3) {
                // YYYY-MM-DD is the standard ISO format preferred by APIs
                isoDate = `${parts[2]}-${parts[1]}-${parts[0]}`; 
            }
            
            // Collect new fields for leave/training/fieldwork
            
            const leave_details = document.getElementById('leave_details').value;
            
            const training_details = document.getElementById('training_details').value;
            
            const fieldwork_details = document.getElementById('fieldwork_details').value;
            const substitute_worker = document.getElementById('substitute_worker').value; // ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ select box
            const notes = document.getElementById('notes').value;

            const data = {
                dateDisplay: dateInput, // DD/MM/YYYY for display/export
                date: isoDate, // Send YYYY-MM-DD to Make.com
                agent: employeeName,
                
                // NEW: Leave/Training/Fieldwork/Substitute Status
                leaveStatus: { 
                    isLeave: leave_checkbox,
                    leaveDetails: leave_details,
                    isTraining: training_checkbox,
                    trainingDetails: training_details,
                    isFieldwork: fieldwork_checkbox,
                    fieldworkDetails: fieldwork_details,
                    substituteWorker: substitute_worker
                },
                
                logEntries: tableData,
                
                notes: notes, 
                createdAt: new Date().toISOString(), 
                createdBy: employeeName     
            };
            
            // 5. ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Export
            lastSubmissionData = data;


            // 6. Send data to Make.com Webhook
            try {
                const response = await fetch(MAKE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    
                    document.getElementById('logForm').reset();
                    
                    // Reset date to today in DD/MM/YYYY format after submission
                    const dateInput = document.getElementById('date');
                    const today = new Date();
                    dateInput.value = formatDate(today); 
                    
                    // Reset select colors and redraw table
                    await loadConfigurationData(); // MODIFIED: Call new function name
                    updateTotalDurationDisplay(); // NEW: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                    
                    showExportModal(); 
                    
                } else {
                    throw new Error(`‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (HTTP Status: ${response.status}).`);
                }
                
            } catch (error) {
                console.error("Error saving document: ", error);
                showMessage(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${error.message}`, "error"); 
            }
        });
        
        // --- 9. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞ Export ‡πÄ‡∏õ‡πá‡∏ô Excel (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå) ---
        function exportDataToExcel() {
            if (!lastSubmissionData) {
                showFinalStatusModal("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
                return;
            }

            const data = lastSubmissionData;
            const dateDisplay = data.dateDisplay.replace(/\//g, '-'); // DD/MM/YYYY -> DD-MM-YYYY
            const employeeName = data.agent;
            
            // NEW: ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢‡πÅ‡∏•‡∏∞‡∏õ‡∏µ ‡∏û.‡∏®. (04 ‡∏û.‡∏¢. 2568)
            const formattedThaiDate = formatDateThaiBuddhist(data.dateDisplay);
            
            // **NEW: Calculate Total Duration (Recalculate based on hours AND minutes)**
            let totalDurationInHours = 0;
            data.logEntries.forEach(entry => {
                const hours = parseFloat(entry.duration);
                if (!isNaN(hours)) {
                    totalDurationInHours += hours;
                }
                const minutes = parseInt(entry.minuteDuration, 10);
                 if (!isNaN(minutes)) {
                    totalDurationInHours += (minutes / 60.0);
                }
            });
            
            // --- START MODIFICATION FOR EXCEL FORMATTING ---
            const totalMinutes = Math.round(totalDurationInHours * 60);
            
            // Calculate full hours and remaining minutes
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            // Prepare the display text for Excel
            let timeDisplay = '';
            
            if (hours > 0) {
                timeDisplay += `${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á`;
            }
            
            // Only show minutes if greater than 0
            if (minutes > 0) {
                // Add space if both hours and minutes exist
                if (hours > 0) { 
                    timeDisplay += ' '; 
                }
                timeDisplay += `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
            }

            // Case where total time is 0
            if (totalMinutes === 0) {
                timeDisplay = '0 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á 0 ‡∏ô‡∏≤‡∏ó‡∏µ'; 
            }
            // --- END MODIFICATION FOR EXCEL FORMATTING ---

            
            // 1. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡πâ‡∏≠‡∏á‡∏Ç‡∏≠: Report_‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô_‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡πá‡∏° ‡πÇ‡∏î‡∏¢‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏≠‡∏±‡∏Å‡∏Ç‡∏£‡∏∞‡∏ó‡∏µ‡πà‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå (/ \ : * ? " < > |) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
            const safeEmployeeName = employeeName.replace(/[\/\\:*?"<>|]/g, '').trim();
            const fileName = `Report_${safeEmployeeName}_${dateDisplay}`;
            
            const combinedTableBody = document.querySelector('#combined-export-table tbody');
            let htmlContent = '';
            
            // 2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (‡∏õ‡∏£‡∏±‡∏ö colspan ‡πÄ‡∏õ‡πá‡∏ô 11 ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏°‡∏µ 11 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)
            htmlContent += `
                <tr><th colspan="11" style="background-color: #e9e5f1; font-weight: bold; text-align: left;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô</th></tr>
                <tr><td style="font-weight: bold;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å:</td><td colspan="10" style="text-align: left; mso-number-format:\@">${formattedThaiDate}</td></tr>
                <tr><td style="font-weight: bold;">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</td><td colspan="10">${data.agent}</td></tr>
                <tr><td style="font-weight: bold;">‡∏•‡∏≤:</td><td colspan="10">${data.leaveStatus.isLeave ? '‡πÉ‡∏ä‡πà' : '‡πÑ‡∏°‡πà'} (${data.leaveStatus.leaveDetails || '-'})</td></tr>
                <tr><td style="font-weight: bold;">‡∏≠‡∏ö‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ:</td><td colspan="10">${data.leaveStatus.isTraining ? '‡πÉ‡∏ä‡πà' : '‡πÑ‡∏°‡πà'} (${data.leaveStatus.trainingDetails || '-'})</td></tr>
                <tr><td style="font-weight: bold;">‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà:</td><td colspan="10">${data.leaveStatus.isFieldwork ? '‡πÉ‡∏ä‡πà' : '‡πÑ‡∏°‡πà'} (${data.leaveStatus.fieldworkDetails || '-'})</td></tr>
                <tr><td style="font-weight: bold;">‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡πÅ‡∏ó‡∏ô:</td><td colspan="10">${data.leaveStatus.substituteWorker || '-'}</td></tr>
                <tr><td style="font-weight: bold;">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ):</td><td colspan="10">${data.notes || '-'}</td></tr>
                
                <tr><td style="font-weight: bold;">‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô:</td><td colspan="10" style="font-weight: bold;">${timeDisplay}</td></tr>
                
                <tr><td colspan="11" style="height: 20px;"></td></tr> 
                `;
            
            // 3. ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô (11 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)
            htmlContent += `
                <tr><th colspan="11" style="background-color: #e9e5f1; font-weight: bold; text-align: left;">** ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô **</th></tr>
                <tr style="background-color: #e9e5f1;">
                    <th style="font-weight: bold;">#</th>
                    <th style="font-weight: bold;">‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á‡∏á‡∏≤‡∏ô</th>
                    <th style="font-weight: bold; mso-number-format:\@">Agent</th> 
                    <th style="font-weight: bold;">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏≤‡∏ô</th>
                    <th style="font-weight: bold;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô</th>
                    <th style="font-weight: bold;">‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</th>
                    <th style="font-weight: bold;">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤(‡∏ä‡∏°.)</th> 
                    <th style="font-weight: bold;">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤(‡∏ô‡∏≤‡∏ó‡∏µ)</th> 
                    <th style="font-weight: bold;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th style="font-weight: bold;">‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤</th>
                    <th style="font-weight: bold;">‡∏•‡∏ö</th> </tr>
            `;

            // 4. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô (11 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà)
            data.logEntries.forEach(entry => {
                // MODIFIED: Use the loaded STATUS_OPTIONS_LOADED
                const statusText = STATUS_OPTIONS_LOADED.find(opt => opt.value === entry.status)?.text || entry.status;
                
                // ‡∏Ñ‡∏á mso-number-format:\@ ‡πÉ‡∏ô Agent Data Cell ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Text
                htmlContent += `
                    <tr>
                        <td>${entry.row}</td>
                        <td>${entry.requesterTable}</td>
                        <td style="mso-number-format:\@">${entry.agentTable}</td>
                        <td>${entry.topicDescription}</td>
                        <td>${entry.detailDescription}</td>
                        <td>${entry.problemFound}</td> 
                        <td>${entry.duration}</td>     
                        <td>${entry.minuteDuration}</td> 
                        <td>${statusText}</td>         
                        <td>${entry.noteTable}</td>    
                        <td></td> </tr>
                `;
            });
            
            // 5. ‡πÉ‡∏™‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            combinedTableBody.innerHTML = htmlContent;

            // 6. ‡πÉ‡∏ä‡πâ Table2Excel ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Export ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            const table2excel = new Table2Excel();
            
            // ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
            table2excel.export([document.getElementById('combined-export-table')], fileName, ["Report"]); 
             
            // 7. ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            lastSubmissionData = null; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        }


        // --- 10. MODAL 1 Button Event Listeners (‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ---
        
        // "Export" Button Logic
        document.getElementById('exportExcelBtn').addEventListener('click', function() {
            hideExportModal();
            exportDataToExcel(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Export
            
            // ‡πÅ‡∏™‡∏î‡∏á Final Modal ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏±‡πà‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
            showFinalStatusModal("‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡∏∞ Export ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå"); 
        });

        // "‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£" Button Logic (Close modal)
        document.getElementById('closeModalBtn').addEventListener('click', function() {
            hideExportModal();
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
            lastSubmissionData = null; 
            showFinalStatusModal("‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå");
        });


        // --- 11. Initialize the page when the page loads ---
        window.addEventListener('load', async () => {
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô DD/MM/YYYY
            const dateInput = document.getElementById('date');
            const today = new Date();
            const formattedToday = formatDate(today); 
            
            dateInput.value = formattedToday; 
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô, Agent ‡πÅ‡∏•‡∏∞‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            await loadConfigurationData(); // MODIFIED: Call new function name

            // NEW: Add event listener for the 'Add Row' button
            document.getElementById('addRowBtn').addEventListener('click', () => {
                 addTableRows(ROWS_TO_ADD_BATCH); // Add 10 more rows
            });
            
            // NEW: Event Delegation for Total Duration Update 
            // Attach a single listener to the table body to catch changes on all rows
            const logTableBody = document.getElementById('log-table-body');
            logTableBody.addEventListener('change', function(e) {
                 if (e.target.name === 'duration-select' || e.target.name === 'minute-select') {
                    updateTotalDurationDisplay();
                 }
            });

            // Initial call to display total duration on load
            updateTotalDurationDisplay();
        });
    </script>

</body>
</html>